
%% Observations %%

\newmacro{O-Value}{
  \begin{function}
    \signature{\Value : \mathrm{Normalised\ task} \times \mathrm{State} \rightharpoonup \mathrm{Value}} \\
  \addlinespace
    \Value(\Enter^k \beta, \sigma)                     &=& \bot \\
    \Value(\Update^k b, \sigma)                        &=& b \\
    \Value(\View^k b, \sigma)                          &=& b \\
    \Value(\Change^k h, \sigma)                        &=& \sigma(h) \\
    \Value(\Watch^k h, \sigma)                         &=& \sigma(h) \\
  \addlinespace
    \Value(\Lift v, \sigma)                            &=& v \\
    \Value(\Fail, \sigma)                              &=& \bot \\
  \addlinespace
    \Value(t_1 \Step e_2, \sigma)                      &=& \bot \\
    \Value(e_1 \Trans t_2, \sigma)                     &=& \left\{
      \begin{array}{ll}
        v_2'                                           & \when\ \Value(t_2,\sigma) = v_2 \land e_1\ v_2 \evaluate v_2' \\
        \obox{\tuple{v_1, v_2}}{\bot}                  & \otherwise \\
      \end{array}
    \right. \\
  \addlinespace
    \Value(t_1 \Pair t_2, \sigma)                      &=& \left\{
      \begin{array}{ll}
        \tuple{v_1, v_2}                               & \when\ \Value(t_1, \sigma) = v_1 \land \Value(t_2, \sigma) = v_2 \\
        \bot                                           & \otherwise \\
      \end{array}
    \right. \\
    \Value(t_1 \Choose t_2, \sigma)                    &=& \left\{
      \begin{array}{ll}
        v_1                                            & \when\ \Value(t_1, \sigma) = v_1 \\
        v_2                                            & \when\ \Value(t_1, \sigma) = \bot \land \Value(t_2, \sigma) = v_2 \\
        \obox{\tuple{v_1, v_2}}{\bot}                  & \otherwise \\
      \end{array}
    \right. \\
  \end{function}
}

\newmacro{O-Value-A}{
  \begin{function}
    \signature{\Value : \mathrm{Normalised\ task} \times \mathrm{State} \rightharpoonup \mathrm{Value}} \\
  \addlinespace
    \Value(\Enter^k \beta, \sigma)                     &=& \bot \\
    \Value(\Update^k b, \sigma)                        &=& b \\
    \Value(\View^k b, \sigma)                          &=& b \\
    \Value(\Change^k h, \sigma)                        &=& \sigma(h) \\
    \Value(\Watch^k h, \sigma)                         &=& \sigma(h) \\
  \addlinespace
    \Value(\Lift v, \sigma)                            &=& v \\
    \Value(\Fail, \sigma)                              &=& \bot \\
  \end{function}
}
\newmacro{O-Value-B}{
  \begin{function}
    \\
  \addlinespace
    \Value(t_1 \Step e_2, \sigma)                      &=& \bot \\
    \Value(e_1 \Trans t_2, \sigma)                     &=& \left\{
      \begin{array}{ll}
        v_2'                                           & \ \when\ \Value(t_2,\sigma) = v_2 \land e_1\ v_2 \evaluate v_2' \\
        \obox{\tuple{v_1, v_2}}{\bot}                  & \ \otherwise \\
      \end{array}
    \right. \\
  \addlinespace
    \Value(t_1 \Pair t_2, \sigma)                      &=& \left\{
      \begin{array}{ll}
        \tuple{v_1, v_2}                               & \ \when\ \Value(t_1, \sigma) = v_1 \land \Value(t_2, \sigma) = v_2 \\
        \bot                                           & \ \otherwise \\
      \end{array}
    \right. \\
    \Value(t_1 \Choose t_2, \sigma)                    &=& \left\{
      \begin{array}{ll}
        v_1                                            & \ \when\ \Value(t_1, \sigma) = v_1 \\
        v_2                                            & \ \when\ \Value(t_1, \sigma) = \bot \land \Value(t_2, \sigma) = v_2 \\
        \obox{\tuple{v_1, v_2}}{\bot}                  & \ \otherwise \\
      \end{array}
    \right. \\
  \end{function}
}

\newmacro{O-Failing}{
  \begin{function}
    \signature{\Failing : \mathrm{Task} \to \mathrm{Boolean}} \\
  \addlinespace
    \Failing(\Fail)                              &=& \True \\
  \addlinespace
    \Failing(e_1 \Trans t_2)                     &=& \Failing(t_2) \\
    \Failing(t_1 \Step e_2)                      &=& \Failing(t_1) \\
    \Failing(t_1 \Pair t_2)                      &=& \Failing(t_1) \land \Failing(t_2) \\
    \Failing(t_1 \Choose t_2)                    &=& \Failing(t_1) \land \Failing(t_2) \\
  \addlinespace
    \Failing(\_)                                 &=& \False \\
  \end{function}
}

\newmacro{O-Inputs}{
  \begin{function}
    \signature{\Inputs : \mathrm{Normalised\ task} \to \powerset{\mathrm{Input}}} \\
  \addlinespace
    \Inputs(\Enter^k \beta)                      &=& \set{k!b' \mid b':\beta} \\
    \Inputs(\Update^k b)                         &=& \set{k!b' \mid b':\beta} \quad\where\ \Update b : \Task\beta \\
    % \Inputs(\View b)                           &=& \nothing
    \Inputs(\Change^k h)                         &=& \set{k!b' \mid b':\beta} \quad\where\ \Change l : \Task\beta \\
    % \Inputs(\Watch h)                          &=& \nothing
  \addlinespace
    \Inputs(e_1 \Trans t_2)                    &=& \Inputs(t_2) \\
    \Inputs(t_1 \Step e_2)                     &=& \Inputs(t_1) \\
    \Inputs(t_1 \Pair t_2)                     &=& \Inputs(t_1) \cup \Inputs(t_2) \\
    \Inputs(t_1 \Choose t_2)                   &=& \Inputs(t_1) \cup \Inputs(t_2) \\
  \addlinespace
    \Inputs(\_)                                &=& \nothing \\
  \end{function}
}

\newmacro{O-Dynamic}{
  \begin{function}
    \signature{\Value : \mathrm{Normalised\ task} \times \mathrm{State} \rightharpoonup \mathrm{Value}} \\
    \Value(\Pool^k_{t_0}[\many{n}], \sigma)  &=&  [\Value(n_i, \sigma) \Mid n_i \in \many{n}] \\
  \addlinespace
    \signature{\Failing : \mathrm{Task} \to \mathrm{Boolean}} \\
    \Failing(\Pool^\nu_{t_0}[\many{t}])  &=&  \False \\
  \addlinespace
    \signature{\Inputs : \mathrm{Normalised\ task} \to \powerset{\mathrm{Input}}} \\
    \Inputs(\Pool^k_{t_0}[\many{n}])  &=&  \set{\Inputs(n_i) \Mid n_i \in \many{n}} \\
                                       & &  \cup\:\set{k \Send \Init} \cup \set{k \Send \Kill i \Mid i \in 1\upto\#\many{n}} \\
  \addlinespace
    \signature{\Watching : \mathrm{Normalised\ task} \to \powerset{\mathrm{Heap\ location}}} \\
    \Watching(\Pool^k_{t_0}[\many{n}]) &=& \bigcup_{n_i\in\many{n}} \Watching(n_i) \\
  \end{function}
}

  \newmacro{O-Hints}{
    \begin{function}
      \signature{         \Hints : \mathrm{Normalised\ task} \times \mathrm{State} \times (\mathrm{Value} \to \mathrm{Path\ condition})} \\
      \signature{\phantom{\Hints :} \to \powerset{\mathrm{Inputs} \times \mathrm{Path\ conditions}}} \\

      \Hints(n, \sigma, \psi) &=& \set{ (\tilde{\iota}, \Psi) \mid n, \sigma \simulate{\tilde{\iota} \cdot \tilde{I}} \tilde{v}|_\Phi,\; \Sat(\Psi)} \\
                              & & \where\ \Psi = \Phi \land \psi(\tilde{v}) \\
    \end{function}
  }
